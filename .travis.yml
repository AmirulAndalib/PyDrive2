cache:
  directories:
    - $HOME/.cache/pip
    - $HOME/.pyenv
dist: xenial
env:
  global:
    - HOMEBREW_NO_AUTO_UPDATE=1
    - PYENV_ROOT="$HOME/.pyenv"
    - PATH="$PYENV_ROOT/bin:$PATH"
    - PIP_CACHE_DIR="$HOME/.cache/pip"  # unify pip cache location for all platforms
stages:
#  - check
#  - test
  - build
# Travis doesn't support testing python on Mac yet, so we need
# to workaround it by installing it directly with brew.
#
# Note that we specify language as ruby-2.4.3 to help us satisfy
# fpm dependencies, as travis runs el capitan with an old ruby
# version, that causes fpm to crash.
#
# Each job will use the previous job's `stage` tag if not specified.
jobs:
  include:
  # patch formatting checks
#  - name: "Check patch formatting"
#    stage: check
#    os: linux
#    language: python
#    python: 3.7
#    before_install:
#    install:
#    script: ./scripts/ci/check_patch.sh
  # test jobs
#  - name: "3.7 on Windows"
#    stage: test
#    os: windows           # Windows 10.0.17134 N/A Build 17134
#    language: shell       # 'language: python' is an error on Travis CI Windows
#  - name: "3.5 on Linux"
#    language: python
#    python: 3.5
#  - name: "3.6 on Linux"
#    language: python
#    python: 3.6
#  - name: "3.7 on Linux"
#    language: python
#    python: 3.7
#  - name: "3.7 on Mac"
#    os: osx
#    osx_image: xcode11.3
  # build jobs
  - name: "Pypi pkgs"
    if: tag is present
    stage: build
    language: python
    python: 3.7
    script: ./scripts/pypi_upload.sh
    deploy:
    - provider: pypi
      user:
        secure: "DSmWBOigx/AFNAoW2psBVBlKvHzt8ms/f5HBlZceh/4w6JGNSege5F+G8ZAT4MARXBFTYkoLOWAyeZgYujjAuFwUYEDDLORGJ/QDgsEnOYLlldPqOmc4ZAl9RJ6hSAzWmXCQUTSprBSSz8bO+NMHhqUlKoycj5k1LgV43HJF1etq/uH31lvTpKQ7lEtLMT857RAwW+4UPLsEDq9cMOudGkI9+94QAl+EHo5miKP8awhAdmxU7pHlkLzYBywfcZee0WC17Oxqr6UmdRIO75ZFILFJfShJj73KpN4ysR4pbgmrS9+9nPzxfkxI7liaRvEH11Co61pRZ6foLkfP4qRojyWD1ANepWAf/JZ8rTiP0nkYYG3+fbGRL42AeecFXkVd+486zZsldMo/CiE/VLpz0Njo12FgvgETzvihNpmjgMVEKZFFJqUN6ZTsqHjGaeKyceydiuI1s8Bh7jlKaQpTQ7BbYPj1vlWPyH9a581zkoci9MyUByxehk7Pfvauh2Is7n23lSmuo6j0wXMGCP45kIIyUe+7JbQPy3tt8Ws7yFl6/p5oiQ/P7J3axLHQYQjCGQz4eqxripPjDHY+clkqQmisyPxV7dpKIi31GoOR7Pomt08vHNhLEomPOyyOFaV/9wOnpLP1Kj9dipLT6zNKcfE6pQD7s/x4aLBrq5bHxys="
      password:
        secure: "UbpbFgvrvgde1tgTXRA+KVP5pamhNT+uVvMR2g0zsYyyuMrcE3umlug4dKaQJa83Df5ZLOfsFPcx99aSabYKpLnviuzlx6wqlEjx/1EoyvVMpYLN2NkTmeikbdTX1LxrVpFiHfJZtvOvT6Qk+K4wq06MGFZ8zqRHJ/+hEgAIFvEPSNQqSw75lEjkujZZlZav2BqfLJNNKFQ96+xY7+3Gm44jRyT2Ya/XhJKKqnArvrcKwhlfoI0MNBAtFpnL8RLtIBbuXwo9EPDDKpndSwuRTduMlJwFe6v7bbCN1XO8bjsDPZ4ZcE70nEEjTpU2UlZTzvkExW6ZiMMLtk1pGlDp9BMCsbD/aUhTwarARfstaqTxCFWT8ifgjcp5RVKbSKDYoyCNg98kVfF+cpb2pGfMowwJnyPv2C3VJxGNSYJysLNW58Cf3Gq/x3gWae/lovddD5aKVKKGVJWogzBem+LAesemaDXgeupxvqFPwNcin6GMUd/FuKpRdUivFHyukOEh7VeiRzep9NXKZCrPk6QCj4TTg8fVU3jcK2mX1vFrt8jmbZ1TLXTKhD493CfhT61wEKH6fc/jhzTl2AMaHxvFfbaydmXHb1Uwm5Gz9vU56YSgmJMSMk/JyPtyA4T2Tyj4N6M8DSCqLaIka681wEUyS2TsPve5Fp9wCvdEcJlZijY="
      skip_existing: true
      file_glob: true
      file:
        - dist/pydrive2*.whl
        - dist/pydrive2*.tar.gz
      skip_cleanup: true
      on:
        tags: true
        repo: iterative/PyDrive2

before_install:
  - bash ./scripts/ci/before_install.sh
  - source env.sh
  - bash ./scripts/ci/check_python.sh
install:
  - bash ./scripts/ci/install.sh
script:
  - bash ./scripts/ci/script.sh
